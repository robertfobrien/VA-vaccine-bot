{"ast":null,"code":"import next from \"next\";\n\nconst puppeteer = require(\"puppeteer\");\n\nconst ig = require('instagram-scraping');\n\nexport default ((req, res) => {\n  (async () => {\n    console.log('####################################################################################################################');\n    console.log(\"{\");\n    console.log(\"type: '\" + \"name\" + \"',\");\n    console.log(\"name: '\" + req.body.name + \"',\");\n    console.log(\"}\");\n    let browser = await puppeteer.launch({\n      headless: false,\n      args: ['--window-size=1920,1080']\n    }); //turn to FALSE to debug\n\n    let page = await browser.newPage();\n\n    if (req.body.youtubelink != \"\") {\n      await page.goto(req.body.youtubelink + '/about', {\n        waitUntil: 'networkidle2'\n      });\n      let youtubeStats = await page.evaluate(() => {\n        var type, name, description, viewsString, viewsNum, subscriberString, subscriberNum, subscriberPrefix;\n        var nameObj = document.querySelector('#channel-name > div > div');\n        if (nameObj != null) name = nameObj.innerText;\n        var descriptionObj = document.querySelector('#description');\n        if (descriptionObj != null) description = descriptionObj.innerText;\n        var subscriberStringObj = document.querySelector('#subscriber-count');\n\n        if (subscriberStringObj != null) {\n          subscriberString = subscriberStringObj.innerText;\n          subscriberString = subscriberString.slice(0, subscriberString.length - 12);\n          subscriberPrefix = subscriberString.slice(0, subscriberString.length - 1);\n        }\n\n        var endLetterObj = document.querySelector('#subscriber-count');\n\n        if (endLetterObj != null) {\n          var endLetter = document.querySelector('#subscriber-count').innerText.slice(0, document.querySelector('#subscriber-count').innerText.length - 12);\n          endLetter = endLetter.slice(endLetter.length - 1);\n          if (endLetter == \"K\") subscriberNum = parseInt(parseFloat(subscriberPrefix) * 1000);else if (endLetter == \"M\") subscriberNum = parseInt(parseFloat(subscriberPrefix) * 1000000);else subscriberNum = parseInt(subscriberString);\n        }\n\n        var viewStringObj = document.querySelectorAll('#right-column > yt-formatted-string')[2];\n\n        if (viewStringObj != null) {\n          viewsString = document.querySelectorAll('#right-column > yt-formatted-string')[2].innerText;\n          viewsString = viewsString.slice(0, viewsString.length - 6);\n          viewsString = viewsString.replace(',', '').replace(',', '').replace(',', '');\n          viewsNum = parseInt(viewsString);\n        }\n\n        var type = 'youtube';\n        return {\n          type,\n          name,\n          description,\n          viewsString,\n          viewsNum,\n          subscriberString,\n          subscriberNum\n        };\n      });\n      console.dir(youtubeStats);\n      await page.goto(req.body.youtubelink, {\n        waitUntil: 'networkidle2'\n      }); //Youtube video arrays and settings:\n\n      var videos = [];\n      const videoHref = await page.evaluate(() => {\n        var hrefs = []; //at max, 6 videos or however many they have, if they have less. \n\n        for (i = 0; i < 6; i++) {\n          if (document.querySelectorAll('a[id=\"video-title\"]')[i] != undefined) hrefs[i] = document.querySelectorAll('a[id=\"video-title\"]')[i].getAttribute('href');else return hrefs;\n        }\n\n        return hrefs;\n      });\n      var videoEmbed = [];\n\n      for (var j = 0; j < videoHref.length; j++) videoEmbed[j] = '<iframe width=\"560\" height=\"315\" src=\"https://www.youtube.com/embed/' + videoHref[j].slice(9) + '\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen></iframe>';\n\n      page.setViewport({\n        width: 1280,\n        height: 1400\n      });\n\n      for (var j = 0; j < videoHref.length; j++) {\n        //TODO sometime the waituntil will not do everything we need it to and sometimes cannot see the page yet when searching later. \n        await page.goto('https://www.youtube.com' + videoHref[j], {\n          waitUntil: 'networkidle0'\n        }); //waits for special selector to load\n\n        await page.waitForSelector('span[class=\"view-count style-scope ytd-video-view-count-renderer\"]', {\n          visible: true\n        });\n        await page.waitForSelector('yt-formatted-string[class=\"count-text style-scope ytd-comments-header-renderer\"] > span', {\n          visible: true\n        });\n        let videoStats = await page.evaluate(() => {\n          let videoViews = document.querySelector('span[class=\"view-count style-scope ytd-video-view-count-renderer\"]').innerText;\n          let videoTitle = document.querySelector('h1[class=\"title style-scope ytd-video-primary-info-renderer\"]').innerText;\n          let videoPosted = document.querySelectorAll('yt-formatted-string[class=\"style-scope ytd-video-primary-info-renderer\"]')[1].innerText;\n          let videoLikes = document.querySelectorAll('yt-formatted-string[class=\"style-scope ytd-toggle-button-renderer style-text\"]')[0].getAttribute('aria-label');\n          let videoDislikes = document.querySelectorAll('yt-formatted-string[class=\"style-scope ytd-toggle-button-renderer style-text\"]')[1].getAttribute('aria-label');\n          var videoComments = document.querySelector('yt-formatted-string[class=\"count-text style-scope ytd-comments-header-renderer\"] > span').innerText;\n\n          function stringToNum(str) {\n            if (str == '') return;\n            str = str.slice(0, str.search(\" \"));\n\n            while (str.search(\",\") != -1) str = str.replace(',', '');\n\n            return str;\n          }\n\n          videoViews = parseInt(stringToNum(videoViews));\n          videoLikes = parseInt(stringToNum(videoLikes));\n          videoDislikes = parseInt(stringToNum(videoDislikes));\n          videoPosted = new Date(\"\" + videoPosted + ' 00:00:00');\n          videoComments = parseInt(stringToNum(videoComments));\n          return {\n            \"title\": videoTitle,\n            \"views\": videoViews,\n            \"posted\": videoPosted.toString(),\n            //this is a Date object, so it will show up as a {} when it prints out\n            \"likes\": videoLikes,\n            \"dislikes\": videoDislikes,\n            \"comments\": videoComments\n          };\n        });\n        const href = videoHref[j],\n              embed = videoEmbed[j];\n        videos[j] = {\n          videoStats,\n          href,\n          embed\n        };\n        console.log(videos[j]);\n      }\n\n      console.dir(videos);\n    }\n\n    if (req.body.instagramlink != \"\") {\n      const positionOfUser = req.body.instagramlink.search('.com/');\n      var instaUser = req.body.instagramlink;\n\n      if (positionOfUser != -1) {\n        instaUser = req.body.instagramlink.slice(positionOfUser + 5);\n        const positionOfSlash = instaUser.search('/');\n        instaUser = instaUser.slice(0, positionOfSlash);\n      }\n\n      ig.scrapeUserPage(instaUser).then(result => {\n        console.dir(result);\n      });\n    }\n\n    if (req.body.tiktoklink != \"\") {\n      await page.goto(req.body.tiktoklink, {\n        waitUntil: 'networkidle2'\n      });\n      page.setViewport({\n        width: 1280,\n        height: 1400\n      });\n      let tiktokStats = await page.evaluate(() => {\n        var website = document.querySelectorAll('.share-links')[0].innerText;\n        var followers = document.querySelectorAll('strong[title=\"Followers\"]')[0].innerText;\n        var likes = document.querySelectorAll('strong[title=\"Likes\"]')[0].innerText;\n        var following = document.querySelectorAll('strong[title=\"Following\"]')[0].innerText;\n        var description = document.querySelectorAll('.share-desc')[0].innerText;\n        var username = document.querySelectorAll('.share-title')[0].innerText; //get the tiktokHrefs\n\n        var tiktokHrefs = [];\n\n        for (var i = 0; i < 6; i++) {\n          if (document.querySelectorAll('.video-feed-item')[i] != undefined) tiktokHrefs[i] = document.querySelectorAll('.video-feed-item')[i].querySelectorAll('a')[0].getAttribute('href');else return tiktokHrefs;\n        }\n\n        return {\n          username,\n          followers,\n          following,\n          likes,\n          website,\n          description,\n          tiktokHrefs\n        };\n      });\n      console.log(tiktokStats); //loop goes through each video, retrieves stats. \n\n      var tiktokVideoStats = [];\n\n      for (var i = 0; i < tiktokStats.tiktokHrefs.length; i++) {\n        await page.goto(tiktokStats.tiktokHrefs[i], {\n          waitUntil: 'networkidle2'\n        });\n        let videoStats = page.evaluate(() => {\n          var vidLikes = document.querySelectorAll('[title=\"like\"]')[0].innerText;\n          var vidComments = document.querySelectorAll('[title=\"comment\"]')[0].innerText;\n          var vidShares = document.querySelectorAll('[title=\"share\"]')[0].innerText;\n          var vidCaption = document.querySelectorAll('.tt-video-meta-caption')[0].innerText;\n          var vidMusicLink = document.querySelectorAll('.video-music-wrapper')[0].getAttribute('href');\n          var vidMusicName = document.querySelectorAll('.video-music-wrapper')[0].innerText;\n          return {\n            vidLikes,\n            vidComments,\n            vidShares,\n            vidCaption,\n            vidMusicName,\n            vidMusicLink\n          };\n        });\n        tiktokVideoStats[i] = videoStats;\n      }\n\n      console.log(tiktokVideoStats);\n    } //end of tiktok scrape\n\n\n    if (req.body.facebooklink != \"\") {\n      //   '/pg/' ensures that the link goes to a page, and not a profile.\n      // Any person who's stats matter will be on a page, not a profile. This forces that.\n      await page.goto('https://www.facebook.com/pg/' + req.body.facebooklink.slice(req.body.facebooklink.search('.com/') + 5), {\n        waitUntil: 'networkidle2'\n      });\n      page.setViewport({\n        width: 1280,\n        height: 1400\n      });\n      let facebookStats = await page.evaluate(() => {\n        var type, name, likes, followers, website, category;\n\n        function stringToNum(str) {\n          if (str == '') return;\n          str = str.slice(0, str.search(\" \"));\n\n          while (str.search(\",\") != -1) str = str.replace(',', '');\n\n          return str;\n        } //loads a few more posts\n\n\n        window.scrollTo(0, window.innerHeight * 2); //type\n\n        type = 'facebook'; //name\n\n        name = document.querySelectorAll('title')[0].innerText;\n        name = name.slice(0, name.search(' - ')); //like count ✔️\n\n        var j = 0;\n\n        while (j >= 0) {\n          if (document.querySelectorAll('div > div[class=\"_4bl9\"]')[j] != null && document.querySelectorAll('div > div[class=\"_4bl9\"]')[j].innerText.contains('people like this')) {\n            likes = document.querySelectorAll('div > div[class=\"_4bl9\"]')[j].innerText;\n            j = -2;\n          }\n\n          j++;\n        }\n\n        likes = stringToNum(likes); //follower count ✔️\n\n        j = 0;\n\n        while (j >= 0) {\n          if (document.querySelectorAll('div > div[class=\"_4bl9\"]')[j] != null && document.querySelectorAll('div > div[class=\"_4bl9\"]')[j].innerText.contains('people follow this')) {\n            followers = document.querySelectorAll('div > div[class=\"_4bl9\"]')[j].innerText;\n            j = -2;\n          }\n\n          j++;\n        }\n\n        followers = stringToNum(followers); //website\n\n        j = 0;\n\n        while (j >= 0 && j < 50) {\n          if (document.querySelectorAll('div > div > a')[j].innerText.contains('www.')) {\n            website = document.querySelectorAll('div > div > a')[j].innerText;\n            j = -2;\n          }\n\n          j++;\n        } //category\n\n\n        j = 10;\n\n        while (j >= 0) {\n          if (document.querySelectorAll('div > div > a')[20].hasAttribute('href') && document.querySelectorAll('div > div > a')[j].getAttribute('href').contains('/pages/category/')) {\n            category = document.querySelectorAll('div > div > a')[j].innerText;\n            j = -2;\n          }\n\n          j++;\n        }\n\n        return {\n          type,\n          name,\n          likes,\n          followers,\n          website,\n          category\n        };\n      });\n      console.dir(facebookStats);\n      /**\n       * let postStats = await page.evaluate(() => {\n          var numPosts = 5;\n          var posts = [], postText = [], postMedia = [], postLikes = [], postComments = [], postShares = [];\n          for(i = 0; i < numPosts; i++)\n              {\n              if(document.querySelectorAll('div[class=\"_5va1 _427x')[i] != null)\n                  {\n                  //start of media section \n                  var medias = [];\n                  var photos = [];\n                  var videos = [];\n                  \n                  //gets all the photos from the post until it finds an icon (with width 18)\n                  var j = 0;\n                  while(document.querySelectorAll('div[class=\"du4w35lb k4urcfbm l9j0dhe7 sjgh65i0\"]')[i].querySelectorAll('img')[j].getAttribute('width') != 18)\n                      {\n                          photos[j] = document.querySelectorAll('div[class=\"du4w35lb k4urcfbm l9j0dhe7 sjgh65i0\"]')[i].querySelectorAll('img')[j].getAttribute('src');\n                          j++\n                      }\n                   //logs all the videos in a post till the videos are returning null\n                      j=0;\n                  while(document.querySelectorAll('div[class=\"du4w35lb k4urcfbm l9j0dhe7 sjgh65i0\"]')[i].querySelectorAll('video')[j] != undefined)\n                  {\n                       videos[j] = document.querySelectorAll('div[class=\"du4w35lb k4urcfbm l9j0dhe7 sjgh65i0\"]')[i].querySelectorAll('video')[j].getAttribute('src');\n                       j++\n                  }\n                  j=0;\n                  \n                  medias = [photos, videos];\n                  postmedia[i] = medias; \n                  //end of media searching\n                   \n                  postText[i] = document.querySelectorAll('div[class=\"kvgmc6g5 cxmmr5t8 oygrvhab hcukyx3x c1et5uql ii04i59q\"] > div')[i].innerText;\n                  postLikes[i] = document.querySelectorAll('div[class=\"du4w35lb k4urcfbm l9j0dhe7 sjgh65i0\"]')[i].querySelectorAll('span[class=\"gpro0wi8 pcp91wgn\"]')[0].innerText;\n                  postComments[i] = document.querySelectorAll('div[class=\"du4w35lb k4urcfbm l9j0dhe7 sjgh65i0\"]')[i].querySelectorAll('div[class=\"gtad4xkn\"]')[0].innerText;\n                  postShares[i] = document.querySelectorAll('div[class=\"du4w35lb k4urcfbm l9j0dhe7 sjgh65i0\"]')[i].querySelectorAll('div[class=\"gtad4xkn\"]')[1].innerText;\n                   post[i] = {\n                      postText,\n                      postMedia, \n                      postLikes, \n                      postComments,\n                      postShares,\n                      }\n                  }\n              else\n                  posts[i] = null;\n              }\n          var type = 'facebook-posts';\n          return {\n              type,\n              posts,\n          }\n      })\n      console.log(postStats);\n       */\n    }\n\n    if (req.body.twitterlink != \"\") {\n      const LINK = req.body.twitterlink;\n      const USERNAME = req.body.twitterlink.slice(req.body.twitterlink.search('.com/') + 5);\n      await page.goto(LINK, {\n        waitUntil: 'networkidle2'\n      });\n      page.setViewport({\n        width: 1280,\n        height: 1400\n      });\n      let twitterStats = await page.evaluate(USERNAME => {\n        var type = 'twitter';\n        var followers = document.querySelectorAll('[href=\"/' + USERNAME + '/followers\"]')[0].innerText;\n        var following = document.querySelectorAll('[href=\"/' + USERNAME + '/following\"]')[0].innerText;\n        return {\n          type,\n          followers,\n          following\n        };\n      });\n      console.log(twitterStats);\n    }\n\n    await browser.close();\n  })();\n\n  res.status(200).json({\n    info: 'scrape page',\n    name: req.body.name\n  });\n});","map":{"version":3,"sources":["/Users/robertobrien/Documents/projects/ghost-scraper/pages/api/scrapePage.js"],"names":["next","puppeteer","require","ig","req","res","console","log","body","name","browser","launch","headless","args","page","newPage","youtubelink","goto","waitUntil","youtubeStats","evaluate","type","description","viewsString","viewsNum","subscriberString","subscriberNum","subscriberPrefix","nameObj","document","querySelector","innerText","descriptionObj","subscriberStringObj","slice","length","endLetterObj","endLetter","parseInt","parseFloat","viewStringObj","querySelectorAll","replace","dir","videos","videoHref","hrefs","i","undefined","getAttribute","videoEmbed","j","setViewport","width","height","waitForSelector","visible","videoStats","videoViews","videoTitle","videoPosted","videoLikes","videoDislikes","videoComments","stringToNum","str","search","Date","toString","href","embed","instagramlink","positionOfUser","instaUser","positionOfSlash","scrapeUserPage","then","result","tiktoklink","tiktokStats","website","followers","likes","following","username","tiktokHrefs","tiktokVideoStats","vidLikes","vidComments","vidShares","vidCaption","vidMusicLink","vidMusicName","facebooklink","facebookStats","category","window","scrollTo","innerHeight","contains","hasAttribute","twitterlink","LINK","USERNAME","twitterStats","close","status","json","info"],"mappings":"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","sourcesContent":["import next from \"next\";\n\nconst puppeteer = require(\"puppeteer\");\nconst ig = require('instagram-scraping');\n\nexport default (req, res) => {\n\n\n    (async () => { \n\n        console.log('####################################################################################################################');\n        console.log(\"{\");\n        console.log(\"type: '\" + \"name\" + \"',\");\n        console.log(\"name: '\" + req.body.name + \"',\");\n        console.log(\"}\");\n        let browser = await puppeteer.launch({headless: false, args: ['--window-size=1920,1080']}); //turn to FALSE to debug\n        let page = await browser.newPage(); \n\n    if(req.body.youtubelink != \"\")\n        {\n        await page.goto(req.body.youtubelink + '/about', {waitUntil: 'networkidle2'});\n        \n        let youtubeStats = await page.evaluate(() => {\n\n            var type, name,description,viewsString,viewsNum,subscriberString,subscriberNum, subscriberPrefix;\n\n            var nameObj = document.querySelector('#channel-name > div > div');\n            if(nameObj != null)\n                name = nameObj.innerText;\n\n            var descriptionObj = document.querySelector('#description');\n            if(descriptionObj != null)\n                description = descriptionObj.innerText;\n            \n            var subscriberStringObj = document.querySelector('#subscriber-count');\n            if(subscriberStringObj != null)\n            {\n                subscriberString = subscriberStringObj.innerText;\n                subscriberString = subscriberString.slice(0, subscriberString.length-12);\n                subscriberPrefix = subscriberString.slice(0,subscriberString.length-1);\n            }\n\n            var endLetterObj = document.querySelector('#subscriber-count');\n            if(endLetterObj != null)\n            {\n                var endLetter = document.querySelector('#subscriber-count').innerText.slice(0,document.querySelector('#subscriber-count').innerText.length-12);\n                endLetter = endLetter.slice(endLetter.length-1);\n                if (endLetter == \"K\")\n                    subscriberNum = parseInt(parseFloat(subscriberPrefix)*1000);\n                else if (endLetter == \"M\")\n                    subscriberNum = parseInt(parseFloat(subscriberPrefix)*1000000);\n                 else \n                subscriberNum = parseInt(subscriberString);\n            }\n\n\n            \n\n\n        \n            var viewStringObj = document.querySelectorAll('#right-column > yt-formatted-string')[2];\n            if (viewStringObj != null)\n            {\n                viewsString = document.querySelectorAll('#right-column > yt-formatted-string')[2].innerText;\n                viewsString = viewsString.slice(0,viewsString.length-6);\n                viewsString = viewsString.replace(',', '').replace(',', '').replace(',', '');\n                viewsNum = parseInt(viewsString);\n            }\n\n            var type = 'youtube';\n\n            return {\n                type,\n                name,\n                description,\n                viewsString,\n                viewsNum,\n                subscriberString,\n                subscriberNum,\n            }\n        })\n\n        console.dir(youtubeStats);\n\n        \n\n        await page.goto(req.body.youtubelink, {waitUntil: 'networkidle2'});\n        //Youtube video arrays and settings:\n        var  videos = [];\n\n\n        const videoHref = await page.evaluate(() => {\n            var hrefs = [];\n            //at max, 6 videos or however many they have, if they have less. \n            for(i = 0; i < 6; i++)\n                {\n                    if(document.querySelectorAll('a[id=\"video-title\"]')[i] != undefined)\n                        hrefs[i] = document.querySelectorAll('a[id=\"video-title\"]')[i].getAttribute('href');\n                    else\n                        return hrefs;\n                }\n            return hrefs;\n        })\n\n        var videoEmbed = []; \n        for(var j = 0; j < videoHref.length; j++)\n            videoEmbed[j] = '<iframe width=\"560\" height=\"315\" src=\"https://www.youtube.com/embed/' + videoHref[j].slice(9) + '\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen></iframe>';\n        \n        page.setViewport({ width: 1280, height: 1400 });\n\n        for(var j = 0; j < videoHref.length; j++)\n            {\n                //TODO sometime the waituntil will not do everything we need it to and sometimes cannot see the page yet when searching later. \n            await page.goto('https://www.youtube.com' + videoHref[j], {waitUntil: 'networkidle0'});\n            //waits for special selector to load\n\n            await page.waitForSelector('span[class=\"view-count style-scope ytd-video-view-count-renderer\"]', {\n                visible: true,\n              });\n            await page.waitForSelector('yt-formatted-string[class=\"count-text style-scope ytd-comments-header-renderer\"] > span', {\n                visible: true,\n              });\n            \n\n            let videoStats = await page.evaluate(() => \n            {\n                let videoViews = document.querySelector('span[class=\"view-count style-scope ytd-video-view-count-renderer\"]').innerText;\n                let videoTitle = document.querySelector('h1[class=\"title style-scope ytd-video-primary-info-renderer\"]').innerText;\n                let videoPosted = document.querySelectorAll('yt-formatted-string[class=\"style-scope ytd-video-primary-info-renderer\"]')[1].innerText;\n                let videoLikes = document.querySelectorAll('yt-formatted-string[class=\"style-scope ytd-toggle-button-renderer style-text\"]')[0].getAttribute('aria-label');\n                let videoDislikes = document.querySelectorAll('yt-formatted-string[class=\"style-scope ytd-toggle-button-renderer style-text\"]')[1].getAttribute('aria-label');\n                var videoComments = document.querySelector('yt-formatted-string[class=\"count-text style-scope ytd-comments-header-renderer\"] > span').innerText;\n\n                function stringToNum(str) {\n                    if(str == '')\n                        return\n                    str = str.slice(0,str.search(\" \"));\n                    while(str.search(\",\") != -1)\n                            str = str.replace(',','');\n                    return str\n                  }\n\n                videoViews = parseInt(stringToNum(videoViews));\n                videoLikes = parseInt(stringToNum(videoLikes));\n                videoDislikes = parseInt(stringToNum(videoDislikes));\n                videoPosted = new Date(\"\" + videoPosted + ' 00:00:00');\n                videoComments = parseInt(stringToNum(videoComments));\n\n                return{\n                    \"title\": videoTitle,\n                    \"views\": videoViews,\n                    \"posted\": videoPosted.toString(), //this is a Date object, so it will show up as a {} when it prints out\n                    \"likes\": videoLikes,\n                    \"dislikes\": videoDislikes,\n                    \"comments\": videoComments,\n                    }\n            });\n\n            const href = videoHref[j], embed = videoEmbed[j];\n            videos[j] = {\n                videoStats,\n                href,\n                embed,\n            }\n            console.log(videos[j]);\n\n        }\n        \n        \n        console.dir(videos);\n        \n        }\n\n    if(req.body.instagramlink != \"\")\n    {    \n        const positionOfUser = req.body.instagramlink.search('.com/');\n        var instaUser = req.body.instagramlink;\n\n        if(positionOfUser != -1)\n        {\n            instaUser = req.body.instagramlink.slice(positionOfUser+5);\n            const positionOfSlash = instaUser.search('/');\n            instaUser = instaUser.slice(0,positionOfSlash);\n        }\n\n        ig.scrapeUserPage(instaUser).then(result => {\n            console.dir(result);\n          });\n    }\n\n    if(req.body.tiktoklink != \"\")\n    {\n        \n        await page.goto(req.body.tiktoklink, {waitUntil: 'networkidle2'});\n        page.setViewport({ width: 1280, height: 1400 });\n        let tiktokStats = await page.evaluate(() => {\n\n            var website = document.querySelectorAll('.share-links')[0].innerText;\n            var followers = document.querySelectorAll('strong[title=\"Followers\"]')[0].innerText;\n            var likes = document.querySelectorAll('strong[title=\"Likes\"]')[0].innerText;\n            var following = document.querySelectorAll('strong[title=\"Following\"]')[0].innerText;\n            var description = document.querySelectorAll('.share-desc')[0].innerText;\n            var username = document.querySelectorAll('.share-title')[0].innerText\n\n            //get the tiktokHrefs\n            var tiktokHrefs = [];\n            for(var i = 0; i < 6; i++)\n            {\n                if(document.querySelectorAll('.video-feed-item')[i] != undefined)\n                    tiktokHrefs[i] = document.querySelectorAll('.video-feed-item')[i].querySelectorAll('a')[0].getAttribute('href');\n                else\n                    return tiktokHrefs; \n            }\n\n            return{\n                username,\n                followers, \n                following,\n                likes,\n                website, \n                description,\n                tiktokHrefs,\n            }\n        });\n        console.log(tiktokStats);\n\n\n        //loop goes through each video, retrieves stats. \n        var tiktokVideoStats = [];\n        for(var i = 0; i < tiktokStats.tiktokHrefs.length; i++)\n        {\n            await page.goto(tiktokStats.tiktokHrefs[i], {waitUntil: 'networkidle2'});\n            let videoStats = page.evaluate(() => {\n                var vidLikes = document.querySelectorAll('[title=\"like\"]')[0].innerText;\n                var vidComments = document.querySelectorAll('[title=\"comment\"]')[0].innerText;\n                var vidShares = document.querySelectorAll('[title=\"share\"]')[0].innerText;\n                var vidCaption = document.querySelectorAll('.tt-video-meta-caption')[0].innerText;\n                var vidMusicLink = document.querySelectorAll('.video-music-wrapper')[0].getAttribute('href');\n                var vidMusicName = document.querySelectorAll('.video-music-wrapper')[0].innerText;\n\n                return{\n                    vidLikes,\n                    vidComments, \n                    vidShares,\n                    vidCaption, \n                    vidMusicName, \n                    vidMusicLink,\n                }\n        })\n        tiktokVideoStats[i] = videoStats;\n        }\n        console.log(tiktokVideoStats);\n    }//end of tiktok scrape\n    \n    if(req.body.facebooklink != \"\")\n    {    \n        //   '/pg/' ensures that the link goes to a page, and not a profile.\n        // Any person who's stats matter will be on a page, not a profile. This forces that.\n        await page.goto( 'https://www.facebook.com/pg/' + req.body.facebooklink.slice(req.body.facebooklink.search('.com/')+5) , {waitUntil: 'networkidle2'});\n\n        \n        page.setViewport({ width: 1280, height: 1400 });\n\n        let facebookStats = await page.evaluate(() => {\n\n            var type,\n            name,\n            likes,\n            followers,\n            website,\n            category;\n\n            function stringToNum(str) {\n                if(str == '')\n                    return\n                str = str.slice(0,str.search(\" \"));\n                while(str.search(\",\") != -1)\n                        str = str.replace(',','');\n                return str;\n              }\n\n            //loads a few more posts\n            window.scrollTo(0,window.innerHeight*2);\n            \n            //type\n            type = 'facebook';\n\n            //name\n            name = document.querySelectorAll('title')[0].innerText;\n            name = name.slice(0, name.search(' - '));\n\n                //like count ✔️\n                var j=0; \n                while(j>=0)\n                    {\n                        if (document.querySelectorAll('div > div[class=\"_4bl9\"]')[j] != null && document.querySelectorAll('div > div[class=\"_4bl9\"]')[j].innerText.contains('people like this'))\n                            {\n                            likes = document.querySelectorAll('div > div[class=\"_4bl9\"]')[j].innerText;\n                            j=-2;\n                            }\n                        j++;\n                    }\n                    likes = stringToNum(likes);\n\n\n                //follower count ✔️\n                j=0; \n                while(j>=0)\n                    {\n                        if (document.querySelectorAll('div > div[class=\"_4bl9\"]')[j] != null && document.querySelectorAll('div > div[class=\"_4bl9\"]')[j].innerText.contains('people follow this'))\n                            {\n                            followers = document.querySelectorAll('div > div[class=\"_4bl9\"]')[j].innerText;\n                            j=-2;\n                            }\n                        j++;\n                    }\n                    followers= stringToNum(followers);\n\n                //website\n                j=0; \n                while(j>=0 && j<50)\n                    {\n                        if (document.querySelectorAll('div > div > a')[j].innerText.contains('www.'))\n                            {\n                            website = document.querySelectorAll('div > div > a')[j].innerText;\n                            j=-2;\n                            }\n                        j++;\n                    }\n                \n                             \n                \n                //category\n                j=10;\n                while(j>=0)\n                    {\n                        if (document.querySelectorAll('div > div > a')[20].hasAttribute('href') && document.querySelectorAll('div > div > a')[j].getAttribute('href').contains('/pages/category/'))\n                            {\n                            category = document.querySelectorAll('div > div > a')[j].innerText;\n                            j=-2;\n                            }\n                        j++;\n                    }\n                    \n            return {\n                type,\n                name,\n                likes,\n                followers,\n                website,\n                category,\n            }\n        })\n        console.dir(facebookStats);\n\n        /**\n         * let postStats = await page.evaluate(() => {\n            var numPosts = 5;\n            var posts = [], postText = [], postMedia = [], postLikes = [], postComments = [], postShares = [];\n            for(i = 0; i < numPosts; i++)\n                {\n                if(document.querySelectorAll('div[class=\"_5va1 _427x')[i] != null)\n                    {\n                    //start of media section \n                    var medias = [];\n                    var photos = [];\n                    var videos = [];\n                    \n                    //gets all the photos from the post until it finds an icon (with width 18)\n                    var j = 0;\n                    while(document.querySelectorAll('div[class=\"du4w35lb k4urcfbm l9j0dhe7 sjgh65i0\"]')[i].querySelectorAll('img')[j].getAttribute('width') != 18)\n                        {\n                            photos[j] = document.querySelectorAll('div[class=\"du4w35lb k4urcfbm l9j0dhe7 sjgh65i0\"]')[i].querySelectorAll('img')[j].getAttribute('src');\n                            j++\n                        }\n\n                    //logs all the videos in a post till the videos are returning null\n                        j=0;\n                    while(document.querySelectorAll('div[class=\"du4w35lb k4urcfbm l9j0dhe7 sjgh65i0\"]')[i].querySelectorAll('video')[j] != undefined)\n                    {\n                         videos[j] = document.querySelectorAll('div[class=\"du4w35lb k4urcfbm l9j0dhe7 sjgh65i0\"]')[i].querySelectorAll('video')[j].getAttribute('src');\n                         j++\n                    }\n                    j=0;\n                    \n                    medias = [photos, videos];\n                    postmedia[i] = medias; \n                    //end of media searching\n\n                    \n                    postText[i] = document.querySelectorAll('div[class=\"kvgmc6g5 cxmmr5t8 oygrvhab hcukyx3x c1et5uql ii04i59q\"] > div')[i].innerText;\n                    postLikes[i] = document.querySelectorAll('div[class=\"du4w35lb k4urcfbm l9j0dhe7 sjgh65i0\"]')[i].querySelectorAll('span[class=\"gpro0wi8 pcp91wgn\"]')[0].innerText;\n                    postComments[i] = document.querySelectorAll('div[class=\"du4w35lb k4urcfbm l9j0dhe7 sjgh65i0\"]')[i].querySelectorAll('div[class=\"gtad4xkn\"]')[0].innerText;\n                    postShares[i] = document.querySelectorAll('div[class=\"du4w35lb k4urcfbm l9j0dhe7 sjgh65i0\"]')[i].querySelectorAll('div[class=\"gtad4xkn\"]')[1].innerText;\n\n                    post[i] = {\n                        postText,\n                        postMedia, \n                        postLikes, \n                        postComments,\n                        postShares,\n                        }\n                    }\n                else\n                    posts[i] = null;\n                }\n            var type = 'facebook-posts';\n            return {\n                type,\n                posts,\n            }\n        })\n        console.log(postStats);\n         */\n\n        \n}\n\n\n    if(req.body.twitterlink != \"\")\n    {        \n        const LINK = req.body.twitterlink;\n        const USERNAME = req.body.twitterlink.slice(req.body.twitterlink.search('.com/')+5);\n        await page.goto(LINK, {waitUntil: 'networkidle2'});\n        page.setViewport({ width: 1280, height: 1400 });\n        \n        let twitterStats = await page.evaluate(USERNAME => {\n            var type = 'twitter'\n            var followers = document.querySelectorAll('[href=\"/' + USERNAME + '/followers\"]')[0].innerText;\n            var following = document.querySelectorAll('[href=\"/' + USERNAME + '/following\"]')[0].innerText;\n\n            return{\n                type,\n                followers,\n                following,\n            }\n        })\n        console.log(twitterStats);\n    }\n\n        await browser.close();\n        })();\n\n\n    res.status(200).json({ info: 'scrape page', name: req.body.name })\n  }\n  "]},"metadata":{},"sourceType":"module"}