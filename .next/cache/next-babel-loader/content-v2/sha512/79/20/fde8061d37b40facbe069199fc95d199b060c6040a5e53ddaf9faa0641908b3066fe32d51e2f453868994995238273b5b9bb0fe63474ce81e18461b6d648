{"ast":null,"code":"import next from \"next\";\n\nconst puppeteer = require(\"puppeteer\");\n\nconst ig = require('instagram-scraping');\n\nexport default ((req, res) => {\n  (async () => {\n    console.log('####################################################################################################################');\n    console.log(\"{\");\n    console.log(\"type: '\" + \"name\" + \"',\");\n    console.log(\"name: '\" + req.body.name + \"',\");\n    console.log(\"}\");\n    let browser = await puppeteer.launch({\n      headless: true\n    }); //turn to FALSE to debug\n\n    let page = await browser.newPage();\n\n    if (req.body.youtubelink != \"\") {\n      await page.goto(req.body.youtubelink + '/about', {\n        waitUntil: 'networkidle2'\n      });\n      let youtubeStats = await page.evaluate(() => {\n        var type, name, description, viewsString, viewsNum, subscriberString, subscriberNum, subscriberPrefix;\n        var nameObj = document.querySelector('#channel-name > div > div');\n        if (nameObj != null) name = nameObj.innerText;\n        var descriptionObj = document.querySelector('#description');\n        if (descriptionObj != null) description = descriptionObj.innerText;\n        var subscriberStringObj = document.querySelector('#subscriber-count');\n\n        if (subscriberStringObj != null) {\n          subscriberString = subscriberStringObj.innerText;\n          subscriberString = subscriberString.slice(0, subscriberString.length - 12);\n          subscriberPrefix = subscriberString.slice(0, subscriberString.length - 1);\n        }\n\n        var endLetterObj = document.querySelector('#subscriber-count');\n\n        if (endLetterObj != null) {\n          var endLetter = document.querySelector('#subscriber-count').innerText.slice(0, document.querySelector('#subscriber-count').innerText.length - 12);\n          endLetter = endLetter.slice(endLetter.length - 1);\n          if (endLetter == \"K\") subscriberNum = parseInt(parseFloat(subscriberPrefix) * 1000);else if (endLetter == \"M\") subscriberNum = parseInt(parseFloat(subscriberPrefix) * 1000000);else subscriberNum = parseInt(subscriberString);\n        }\n\n        var viewStringObj = document.querySelectorAll('#right-column > yt-formatted-string')[2];\n\n        if (viewStringObj != null) {\n          viewsString = document.querySelectorAll('#right-column > yt-formatted-string')[2].innerText;\n          viewsString = viewsString.slice(0, viewsString.length - 6);\n          viewsString = viewsString.replace(',', '').replace(',', '').replace(',', '');\n          viewsNum = parseInt(viewsString);\n        }\n\n        var type = 'youtube';\n        return {\n          type,\n          name,\n          description,\n          viewsString,\n          viewsNum,\n          subscriberString,\n          subscriberNum\n        };\n      });\n      await page.goto(req.body.youtubelink + \"/featured\", {\n        waitUntil: 'networkidle2'\n      });\n      let videoStats = await page.evaluate(() => {\n        var videos = [];\n        var videoStrings = [];\n        const videosNum = 4;\n\n        for (i = 0; i < videosNum; i++) {\n          if (document.querySelectorAll('#items > ytd-grid-video-renderer')[i] != null) videoStrings[i] = document.querySelectorAll('#items > ytd-grid-video-renderer')[i].innerText;\n        }\n\n        var videoTime = [],\n            videoDescription = [],\n            videoViewsString = [],\n            videoViewsNum = [],\n            daysAgo = [];\n\n        for (i = 0; i < videosNum; i++) {\n          var videoString, endPos, startPos;\n          videoString = videoStrings[i];\n          startPos = 0;\n          endPos = videoString.search('\\n');\n          videoTime[i] = videoString.slice(startPos, endPos);\n          endPos = endPos;\n          videoString = videoString.slice(endPos);\n          startPos = videoString.search('\\n') + 3;\n          videoString = videoString.slice(startPos);\n          startPos = videoString.search('\\n') + 1;\n          videoString = videoString.slice(startPos);\n          endPos = videoString.search('\\n');\n          videoDescription[i] = videoString.slice(0, endPos);\n          videoViewsString[i] = videoString.slice(endPos + 2, endPos + 10);\n          var last = videoViewsString[i].search('\\n');\n          videoViewsString[i] = videoViewsString[i].slice(0, last - 4);\n          var endLetter = videoViewsString[i].slice(videoViewsString[i].length - 1);\n          if (endLetter == \"K\") videoViewsNum[i] = parseInt(parseFloat(videoViewsString[i].slice(0, videoViewsString[i].length - 1)) * 1000);else if (endLetter == \"M\") videoViewsNum[i] = parseInt(parseFloat(videoViewsString[i].slice(0, videoViewsString[i].length - 1)) * 1000000);else videoViewsNum[i] = parseInt(videoViewsString[i]);\n          daysAgo[i] = videoString.slice(videoString.search('views\\n') + 6);\n          videos[i] = {\n            \"time\": videoTime[i],\n            \"description\": videoDescription[i],\n            \"viewsString\": videoViewsString[i],\n            \"viewsNum\": videoViewsNum[i],\n            \"posted\": daysAgo[i]\n          };\n        }\n\n        var type = 'youtube-videos';\n        return {\n          type,\n          videos\n        };\n      });\n      console.log(videoStats);\n      console.log(youtubeStats);\n    }\n\n    if (req.body.instagramlink != \"\") {\n      // using username for scraping\n      //cuts out just the username from the link\n      const positionOfUser = req.body.instagramlink.search('.com/');\n      var instaUser = req.body.instagramlink;\n\n      if (positionOfUser != -1) {\n        instaUser = req.body.instagramlink.slice(positionOfUser + 5);\n        const positionOfSlash = instaUser.search('/');\n        instaUser = instaUser.slice(0, positionOfSlash);\n      }\n\n      ig.scrapeUserPage(instaUser).then(result => {\n        console.dir(result);\n      });\n    }\n\n    if (req.body.facebooklink != \"\") {\n      await page.goto(req.body.facebooklink, {\n        waitUntil: 'networkidle2'\n      });\n      let facebookStats = await page.evaluate(() => {\n        var type, name, likes, followers, website, category;\n        if (document.querySelector('a[class=\"_64-f\"] > span') != null) name = document.querySelector('a[class=\"_64-f\"] > span').innerText;\n\n        if (document.querySelectorAll('div[class=\"_4-u2 _6590 _3xaf _4-u8\"] > div > div > div > div')[0] != null) {\n          likes = document.querySelectorAll('div[class=\"_4-u2 _6590 _3xaf _4-u8\"] > div > div > div > div')[0].innerText;\n          likes = likes.slice(0, likes.length - 17).replace(',', '').replace(',', '').replace(',', '');\n        }\n\n        if (document.querySelectorAll('div[class=\"_4-u2 _6590 _3xaf _4-u8\"] > div > div > div._4bl9 > div')[1] != null) {\n          followers = document.querySelectorAll('div[class=\"_4-u2 _6590 _3xaf _4-u8\"] > div > div > div._4bl9 > div')[1].innerText;\n          followers = followers.slice(0, followers.length - 19).replace(',', '').replace(',', '').replace(',', '');\n        }\n\n        if (document.querySelectorAll('#u_0_q_Oa > div > a')[1] != null) website = document.querySelectorAll('#u_0_q_Oa > div > a')[1].innerText;\n\n        if (document.querySelectorAll('div[class=\"_4bl9\"] > div')[4] != null) {\n          category = document.querySelectorAll('div[class=\"_4bl9\"] > div')[4].innerText; //handles for some pages that added \"contact on messenger\"\n\n          if (category.search('Contact') > -1) category = document.querySelectorAll('div[class=\"_4bl9\"] > div')[5].innerText;\n        }\n\n        var type = 'facebook';\n        var likesNum = parseInt(likes);\n        var followersNum = parseInt(followers);\n        return {\n          type,\n          name,\n          likesNum,\n          followersNum,\n          website,\n          category\n        };\n      });\n      let postStats = await page.evaluate(() => {\n        var posts = [];\n\n        for (i = 0; i < 2; i++) {\n          if (document.querySelectorAll('div[class=\"_5va1 _427x')[i] != null) posts[i] = document.querySelectorAll('div[class=\"_5va1 _427x')[i].innerText;else posts[i] = null;\n        }\n\n        var type = 'facebook-posts';\n        return {\n          type,\n          posts\n        };\n      });\n      console.log(postStats);\n      console.log(facebookStats);\n    }\n\n    await browser.close();\n  })();\n\n  res.status(200).json({\n    info: 'scrape page',\n    name: req.body.name\n  });\n});","map":{"version":3,"sources":["/Users/robertobrien/Documents/projects/ghost-scraper/pages/api/scrapePage.js"],"names":["next","puppeteer","require","ig","req","res","console","log","body","name","browser","launch","headless","page","newPage","youtubelink","goto","waitUntil","youtubeStats","evaluate","type","description","viewsString","viewsNum","subscriberString","subscriberNum","subscriberPrefix","nameObj","document","querySelector","innerText","descriptionObj","subscriberStringObj","slice","length","endLetterObj","endLetter","parseInt","parseFloat","viewStringObj","querySelectorAll","replace","videoStats","videos","videoStrings","videosNum","i","videoTime","videoDescription","videoViewsString","videoViewsNum","daysAgo","videoString","endPos","startPos","search","last","instagramlink","positionOfUser","instaUser","positionOfSlash","scrapeUserPage","then","result","dir","facebooklink","facebookStats","likes","followers","website","category","likesNum","followersNum","postStats","posts","close","status","json","info"],"mappings":"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","sourcesContent":["import next from \"next\";\n\nconst puppeteer = require(\"puppeteer\");\nconst ig = require('instagram-scraping');\n\nexport default (req, res) => {\n\n    (async () => { \n\n        console.log('####################################################################################################################');\n        console.log(\"{\");\n        console.log(\"type: '\" + \"name\" + \"',\");\n        console.log(\"name: '\" + req.body.name + \"',\");\n        console.log(\"}\");\n        let browser = await puppeteer.launch({headless: true}); //turn to FALSE to debug\n        let page = await browser.newPage(); \n\n    if(req.body.youtubelink != \"\")\n        {\n        await page.goto(req.body.youtubelink + '/about', {waitUntil: 'networkidle2'});\n        \n        let youtubeStats = await page.evaluate(() => {\n\n            var type, name,description,viewsString,viewsNum,subscriberString,subscriberNum, subscriberPrefix;\n\n            var nameObj = document.querySelector('#channel-name > div > div');\n            if(nameObj != null)\n                name = nameObj.innerText;\n\n            var descriptionObj = document.querySelector('#description');\n            if(descriptionObj != null)\n                description = descriptionObj.innerText;\n            \n            var subscriberStringObj = document.querySelector('#subscriber-count');\n            if(subscriberStringObj != null)\n            {\n                subscriberString = subscriberStringObj.innerText;\n                subscriberString = subscriberString.slice(0, subscriberString.length-12);\n                subscriberPrefix = subscriberString.slice(0,subscriberString.length-1);\n            }\n\n            var endLetterObj = document.querySelector('#subscriber-count');\n            if(endLetterObj != null)\n            {\n                var endLetter = document.querySelector('#subscriber-count').innerText.slice(0,document.querySelector('#subscriber-count').innerText.length-12);\n                endLetter = endLetter.slice(endLetter.length-1);\n                if (endLetter == \"K\")\n                    subscriberNum = parseInt(parseFloat(subscriberPrefix)*1000);\n                else if (endLetter == \"M\")\n                    subscriberNum = parseInt(parseFloat(subscriberPrefix)*1000000);\n                 else \n                subscriberNum = parseInt(subscriberString);\n            }\n\n\n            \n\n\n        \n            var viewStringObj = document.querySelectorAll('#right-column > yt-formatted-string')[2];\n            if (viewStringObj != null)\n            {\n                viewsString = document.querySelectorAll('#right-column > yt-formatted-string')[2].innerText;\n                viewsString = viewsString.slice(0,viewsString.length-6);\n                viewsString = viewsString.replace(',', '').replace(',', '').replace(',', '');\n                viewsNum = parseInt(viewsString);\n            }\n\n            var type = 'youtube';\n\n            return {\n                type,\n                name,\n                description,\n                viewsString,\n                viewsNum,\n                subscriberString,\n                subscriberNum,\n            }\n        })\n\n        \n        await page.goto(req.body.youtubelink + \"/featured\", {waitUntil: 'networkidle2'});\n\n        let videoStats = await page.evaluate(() => {\n            var videos = [];\n            var videoStrings = [];\n            const videosNum = 4;\n\n            for(i = 0; i < videosNum; i++)\n                {\n                    if(document.querySelectorAll('#items > ytd-grid-video-renderer')[i] != null)\n                        videoStrings[i] = document.querySelectorAll('#items > ytd-grid-video-renderer')[i].innerText;\n                }\n\n            var  videoTime = [], videoDescription = [], videoViewsString = [], videoViewsNum = [], daysAgo = []; \n\n            for(i = 0; i < videosNum; i++)\n                {\n                \n\n                var videoString, endPos, startPos;\n                    \n                    videoString = videoStrings[i];\n                    \n                    \n                    startPos = 0;\n                    endPos = videoString.search('\\n');\n\n                    videoTime[i] = videoString.slice(startPos,endPos);\n\n                    endPos = endPos; \n\n                    videoString = videoString.slice(endPos);\n\n                    startPos = videoString.search('\\n') + 3;\n                    videoString = videoString.slice(startPos);\n\n                    startPos = videoString.search('\\n')+1;\n                    videoString = videoString.slice(startPos);\n                    endPos = videoString.search('\\n');\n\n                    videoDescription[i] = videoString.slice(0,endPos);\n\n                    videoViewsString[i] = videoString.slice(endPos + 2, endPos + 10);\n                    var last = videoViewsString[i].search('\\n');\n                    videoViewsString[i] = videoViewsString[i].slice(0, last - 4);\n\n                    var endLetter = videoViewsString[i].slice(videoViewsString[i].length-1);\n                    if (endLetter == \"K\")\n                        videoViewsNum[i] = parseInt(parseFloat(videoViewsString[i].slice(0, videoViewsString[i].length-1))*1000);\n                    else if (endLetter == \"M\")\n                        videoViewsNum[i] = parseInt(parseFloat(videoViewsString[i].slice(0, videoViewsString[i].length-1))*1000000);\n                    else \n                        videoViewsNum[i] = parseInt(videoViewsString[i]);\n\n                    daysAgo[i] = videoString.slice(videoString.search('views\\n')+6);\n\n                    videos[i] =\n                    {\n                        \"time\": videoTime[i],\n                        \"description\": videoDescription[i],\n                        \"viewsString\": videoViewsString[i],\n                        \"viewsNum\": videoViewsNum[i],\n                        \"posted\": daysAgo[i],\n                    }\n                }\n            var type = 'youtube-videos';\n            return {\n                type,\n                videos,\n            }\n        })\n        console.log(videoStats);\n        \n        \n       console.log(youtubeStats);\n        \n        }\n\n    if(req.body.instagramlink != \"\")\n    {    \n        \n        // using username for scraping\n        //cuts out just the username from the link\n        const positionOfUser = req.body.instagramlink.search('.com/');\n        var instaUser = req.body.instagramlink;\n\n        if(positionOfUser != -1)\n        {\n            instaUser = req.body.instagramlink.slice(positionOfUser+5);\n            const positionOfSlash = instaUser.search('/');\n            instaUser = instaUser.slice(0,positionOfSlash);\n        }\n\n        ig.scrapeUserPage(instaUser).then(result => {\n            console.dir(result);\n          });\n    }\n \n    \n    if(req.body.facebooklink != \"\")\n    {    \n        \n        await page.goto(req.body.facebooklink , {waitUntil: 'networkidle2'});\n\n        let facebookStats = await page.evaluate(() => {\n\n            var type,\n            name,\n            likes,\n            followers,\n            website,\n            category;\n\n            if(document.querySelector('a[class=\"_64-f\"] > span') != null)\n                name = document.querySelector('a[class=\"_64-f\"] > span').innerText;\n            if(document.querySelectorAll('div[class=\"_4-u2 _6590 _3xaf _4-u8\"] > div > div > div > div')[0] != null)\n            {\n                likes = document.querySelectorAll('div[class=\"_4-u2 _6590 _3xaf _4-u8\"] > div > div > div > div')[0].innerText;\n                likes = likes.slice(0,likes.length-17).replace(',', '').replace(',', '').replace(',', '');\n            }\n            if(document.querySelectorAll('div[class=\"_4-u2 _6590 _3xaf _4-u8\"] > div > div > div._4bl9 > div')[1] != null)\n            {\n                followers = document.querySelectorAll('div[class=\"_4-u2 _6590 _3xaf _4-u8\"] > div > div > div._4bl9 > div')[1].innerText;\n                followers = followers.slice(0,followers.length-19).replace(',', '').replace(',', '').replace(',', '');\n            }\n            if(document.querySelectorAll('#u_0_q_Oa > div > a')[1] != null)\n                website = document.querySelectorAll('#u_0_q_Oa > div > a')[1].innerText;\n            if(document.querySelectorAll('div[class=\"_4bl9\"] > div')[4] != null)\n                {\n                category = document.querySelectorAll('div[class=\"_4bl9\"] > div')[4].innerText;\n                //handles for some pages that added \"contact on messenger\"\n                if(category.search('Contact') > -1)\n                    category = document.querySelectorAll('div[class=\"_4bl9\"] > div')[5].innerText;\n                }\n            var type = 'facebook';\n\n            \n            var likesNum = parseInt(likes);\n            var followersNum = parseInt(followers);\n\n            return {\n                type,\n                name,\n                likesNum,\n                followersNum,\n                website,\n                category,\n            }\n        })\n\n        let postStats = await page.evaluate(() => {\n            var posts = [];\n            for(i = 0; i < 2; i++)\n                {\n                if(document.querySelectorAll('div[class=\"_5va1 _427x')[i] != null)\n                    posts[i] = document.querySelectorAll('div[class=\"_5va1 _427x')[i].innerText;\n                else\n                    posts[i] = null;\n                }\n            var type = 'facebook-posts';\n            return {\n                type,\n                posts,\n            }\n        })\n        console.log(postStats);\n        console.log(facebookStats);\n}\n\n        await browser.close();\n\n        })();\n\n\n    res.status(200).json({ info: 'scrape page', name: req.body.name })\n  }\n  "]},"metadata":{},"sourceType":"module"}